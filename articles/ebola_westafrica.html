<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting a multi-country model for Ebola transmission in West Africa using the stemr package • stemr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting a multi-country model for Ebola transmission in West Africa using the stemr package">
<meta property="og:description" content="stemr">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stemr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/stemr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ebola_westafrica.html">Fitting a multi-country model for Ebola transmission in West Africa using the stemr package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fintzij/stemr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ebola_westafrica_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting a multi-country model for Ebola transmission in West Africa using the stemr package</h1>
                        <h4 class="author">Jonathan Fintz, Jon Wakefield, and Vladimir N. Minin</h4>
            
            <h4 class="date">2021-08-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/fintzij/stemr/blob/master/vignettes/ebola_westafrica.Rmd"><code>vignettes/ebola_westafrica.Rmd</code></a></small>
      <div class="hidden name"><code>ebola_westafrica.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>This vignette demonstrates how to simulate from and fit a multi-country SEIR model incorporating within-country transmission as well as importation of cases from neighboring countries to partially observed incidence data using the the <code>stemr</code> package. This model was described and used in Fintzi, et al. (2020) to analyze national level incidence counts from the 2014-2015 outbreak of Ebola in West Africa, though the focus of this vignette will be on fitting the model to simulated data in order to also demonstrate the simulation functionality of the package. The real data is included in the package and is accessible by calling <code><a href="https://rdrr.io/r/utils/data.html">data("ebola")</a></code> once the package is loaded. The models fit to the West Africa data and simulated data are largely the same, with only slight differences in the prior hyperparameters and the length of the simulated outbreak (70 vs. 73 weeks). Hence, the code used to fit the model to simulated data can also be used to analyze the real-world outbreak data.</p>
</div>
<div id="model-description" class="section level1">
<h1 class="hasAnchor">
<a href="#model-description" class="anchor"></a>Model description</h1>
<p>We will simulate from and fit a multi–country model for the spread of Ebola in Guinea, Liberia, and Sierra Leone under country–specific SEIR transmission dynamics, illustrated in the figure below. Cross–border transmission was incorporated via virtual migration of infectious individuals and was parameterized by extrinsic reproduction numbers, interpretable as the expected number of secondary cases in a country per index case in another country. Transmission was assumed to commence in Liberia on March 2<span class="math inline">\(^{nd}\)</span>, 2014, and in Sierra Leone on May 4$ ^{th}$, 2014, corresponding to three weeks prior to the first cases in those countries. The observed incidence in each country was modeled as a negative binomial sample of the true incidence. The total incidence in each country was small relative to the population size, suggesting that only a fraction of the population was geographically or socially linked to ongoing transmission. Hence, we estimated the effective population size in each country, interpreted as the size of the sub–population within which the outbreak occurred.</p>
<div class="figure">
<img src="ebola_mod_fig.png" alt=""><p class="caption">Diagram of state transitions for a joint model for Ebola transmission in Guinea, Liberia, and Sierra Leone. Dotted boxes denote countries, nodes in circles denote the model compartments: susceptible but removed from infectious contact <span class="math inline">\((S^R)\)</span>, susceptible but exposed to infectious contact <span class="math inline">\((S^E)\)</span>, exposed <span class="math inline">\((E)\)</span>, infectious <span class="math inline">\((I)\)</span>, recovered <span class="math inline">\((R)\)</span>. Compartments are subscripted with country indicators. Solid lines with arrows indicate stochastic transitions between model compartments, which occur continuously in time. Dashed lines indicate that infected individuals in one country contribute to the force of infection in another country. Rates at which individuals transition between compartments are denoted by <span class="math inline">\(\lambda\)</span> and are subscripted by compartments and superscripted by countries, e.g., <span class="math inline">\(\lambda_{S^EE}^L\)</span> is the rate at which susceptible individuals become exposed in Liberia. Transmission in Liberia and Sierra Leone was assumed to commence at 10 and 19 weeks, respectively.</p>
</div>
<table class="table">
<caption>Parameters and their interpretations. Subscripts, <span class="math inline">\(A,B\)</span>, indicate countries.</caption>
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">Parameter</th>
<th align="center">Interpretation</th>
<th align="center">Transition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(\beta_A(t)\)</span></td>
<td align="center">Per–contact rate of transmission within country <span class="math inline">\(A\)</span>.</td>
<td align="center"><span class="math inline">\(S^{E}_A \rightarrow E_A\)</span></td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\alpha_{AB}(t)\)</span></td>
<td align="center">Per–contact rate of transmission from country <span class="math inline">\(A\)</span> to <span class="math inline">\(B\)</span>.</td>
<td align="center"><span class="math inline">\(S^{E}_A \rightarrow E_A\)</span></td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(\omega_A(t)\)</span></td>
<td align="center">Rate at which latent individuals become infectious.</td>
<td align="center"><span class="math inline">\(E_A \rightarrow I_A\)</span></td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\mu_A(t)\)</span></td>
<td align="center">Rate at which infectious individuals recover.</td>
<td align="center"><span class="math inline">\(I_A \rightarrow R_A\)</span></td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(P_{eff,A}\)</span></td>
<td align="center">Effective population size.</td>
<td align="center">—</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\rho_A\)</span></td>
<td align="center">Mean case detection rate.</td>
<td align="center">—</td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(\phi_A\)</span></td>
<td align="center">Negative binomial overdispersion.</td>
<td align="center">—</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Rates of state transition. Subscripts for rates indicate model compartments and superscripts indicate countries, while subscripts for compartments and parameters indicate countries. All rates of state transition for Liberia and Sierra Leone are zero until three weeks prior to the first detected case, when transmission was assumed to commence in each country.</caption>
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="center">Rate</th>
<th align="center">Transition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(\lambda^{A}_{S^EE}(t) = \beta_A(t)\left (I_A + \alpha_{BA}(t)I_B + \alpha_{CA}(t)I_C\right )S^E_A\)</span></td>
<td align="center"><span class="math inline">\(S^E_A\rightarrow E_A\)</span></td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(\lambda^{A}_{EI}(t) = \omega_A(t)E_A\)</span></td>
<td align="center"><span class="math inline">\(E_A\rightarrow I_A\)</span></td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(\lambda^A_{IR}(t) = \mu_A(t)I_A\)</span></td>
<td align="center"><span class="math inline">\(I_A \rightarrow R_A\)</span></td>
</tr>
</tbody>
</table>
</div>
<div id="simulating-from-and-fitting-the-model" class="section level1">
<h1 class="hasAnchor">
<a href="#simulating-from-and-fitting-the-model" class="anchor"></a>Simulating from and fitting the model</h1>
<p>We initialize parameters and instatiate the SIR model in the code block below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fintzij/stemr">stemr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">52787</span><span class="op">)</span>

<span class="co"># total population sizes</span>
<span class="va">popsize_guin</span> <span class="op">&lt;-</span> <span class="fl">11.8e6</span>
<span class="va">popsize_lib</span> <span class="op">&lt;-</span> <span class="fl">4.4e6</span>
<span class="va">popsize_sln</span> <span class="op">&lt;-</span> <span class="fl">7.1e6</span>

<span class="va">log_popsize_guin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_guin</span><span class="op">)</span>
<span class="va">log_popsize_lib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_lib</span><span class="op">)</span>
<span class="va">log_popsize_sln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_sln</span><span class="op">)</span>

<span class="co"># effective population sizes (i.e., number of susceptibles)</span>
<span class="va">ep_guin</span> <span class="op">&lt;-</span> <span class="fl">2e4</span>
<span class="va">ep_lib</span> <span class="op">&lt;-</span> <span class="fl">3.5e4</span>
<span class="va">ep_sln</span> <span class="op">&lt;-</span> <span class="fl">2.5e4</span>

<span class="co"># initialize model dynamics</span>
<span class="co"># each country is a stratum with SEIR compartments</span>
<span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"guin"</span>, <span class="st">"lib"</span>, <span class="st">"sln"</span><span class="op">)</span>

<span class="co"># compartments given in a list, ALL is a reserved keyword indicating that </span>
<span class="co"># the compartment is present in all strata (countries). alternately, a character</span>
<span class="co"># vector of strata in which each compartment occurs could be supplied</span>
<span class="va">compartments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>S <span class="op">=</span> <span class="st">"ALL"</span>, E <span class="op">=</span> <span class="st">"ALL"</span>, I <span class="op">=</span> <span class="st">"ALL"</span>, R <span class="op">=</span> <span class="st">"ALL"</span><span class="op">)</span>

<span class="co"># rates of state transition - see help('rate') for additional details on specifying </span>
<span class="co"># rates. note that transmission_lib and transmission_sln are time-varying covariates</span>
<span class="co"># that will be declared below.</span>
<span class="va">rates</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
            <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
                  rate <span class="op">=</span> <span class="st">"beta_guin * (I_guin + transmission_lib * alpha_lib2guin * I_lib + transmission_sln * alpha_sln2guin * I_sln) * S_guin"</span>,
                  from <span class="op">=</span> <span class="st">"S"</span>,
                  to <span class="op">=</span> <span class="st">"E"</span>,
                  strata <span class="op">=</span> <span class="st">"guin"</span>,
                  lumped <span class="op">=</span> <span class="cn">TRUE</span>,
                  incidence <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
                  <span class="st">"transmission_lib * beta_lib * (I_lib + alpha_guin2lib * I_guin + transmission_sln * alpha_sln2lib * I_sln) * S_lib"</span>,
                  from <span class="op">=</span> <span class="st">"S"</span>,
                  to <span class="op">=</span> <span class="st">"E"</span>,
                  strata <span class="op">=</span> <span class="st">"lib"</span>,
                  lumped <span class="op">=</span> <span class="cn">TRUE</span>,
                  incidence <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
                  <span class="st">"transmission_sln * beta_sln * (I_sln + alpha_guin2sln * I_guin + transmission_lib * alpha_lib2sln * I_lib) * S_sln"</span>,
                  from <span class="op">=</span> <span class="st">"S"</span>,
                  to <span class="op">=</span> <span class="st">"E"</span>,
                  strata <span class="op">=</span> <span class="st">"sln"</span>,
                  lumped <span class="op">=</span> <span class="cn">TRUE</span>,
                  incidence <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
                  <span class="st">"omega_guin"</span>,
                  from <span class="op">=</span> <span class="st">"E"</span>,
                  to <span class="op">=</span> <span class="st">"I"</span>,
                  strata <span class="op">=</span> <span class="st">"guin"</span>,
                  incidence <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
                  <span class="st">"transmission_lib * omega_lib"</span>,
                  from <span class="op">=</span> <span class="st">"E"</span>,
                  to <span class="op">=</span> <span class="st">"I"</span>,
                  strata <span class="op">=</span> <span class="st">"lib"</span>,
                  incidence <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
                  <span class="st">"transmission_sln * omega_sln"</span>,
                  from <span class="op">=</span> <span class="st">"E"</span>,
                  to <span class="op">=</span> <span class="st">"I"</span>,
                  strata <span class="op">=</span> <span class="st">"sln"</span>,
                  incidence <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
                  <span class="st">"mu_guin"</span>,
                  from <span class="op">=</span> <span class="st">"I"</span>,
                  to <span class="op">=</span> <span class="st">"R"</span>,
                  strata <span class="op">=</span> <span class="st">"guin"</span>,
                  incidence <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
                  <span class="st">"transmission_lib * mu_lib"</span>,
                  from <span class="op">=</span> <span class="st">"I"</span>,
                  to <span class="op">=</span> <span class="st">"R"</span>,
                  strata <span class="op">=</span> <span class="st">"lib"</span>,
                  incidence <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
                  <span class="st">"transmission_sln * mu_sln"</span>,
                  from <span class="op">=</span> <span class="st">"I"</span>,
                  to <span class="op">=</span> <span class="st">"R"</span>,
                  strata <span class="op">=</span> <span class="st">"sln"</span>,
                  incidence <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>
      <span class="op">)</span>

<span class="co"># function for initializing the compartment volumes at time 0</span>
<span class="co"># this is a list of stem_initializer lists, one for each stratum</span>
<span class="va">state_initializer</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
            <span class="fu"><a href="../reference/stem_initializer.html">stem_initializer</a></span><span class="op">(</span>
                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
                        S_guin <span class="op">=</span> <span class="va">ep_guin</span> <span class="op">-</span> <span class="fl">30</span>,
                        E_guin <span class="op">=</span> <span class="fl">15</span>,
                        I_guin <span class="op">=</span> <span class="fl">10</span>,
                        R_guin <span class="op">=</span> <span class="fl">5</span>
                  <span class="op">)</span>,
                  fixed <span class="op">=</span> <span class="cn">TRUE</span>,
                  strata <span class="op">=</span> <span class="st">"guin"</span>,
                  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_guin</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/stem_initializer.html">stem_initializer</a></span><span class="op">(</span>
                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
                        S_lib <span class="op">=</span> <span class="va">ep_lib</span> <span class="op">-</span> <span class="fl">30</span>,
                        E_lib <span class="op">=</span> <span class="fl">15</span>,
                        I_lib <span class="op">=</span> <span class="fl">10</span>,
                        R_lib <span class="op">=</span> <span class="fl">5</span>
                  <span class="op">)</span>,
                  fixed <span class="op">=</span> <span class="cn">TRUE</span>,
                  strata <span class="op">=</span> <span class="st">"lib"</span>,
                  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_lib</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/stem_initializer.html">stem_initializer</a></span><span class="op">(</span>
                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
                        S_sln <span class="op">=</span> <span class="va">ep_sln</span> <span class="op">-</span> <span class="fl">30</span>,
                        E_sln <span class="op">=</span> <span class="fl">15</span>,
                        I_sln <span class="op">=</span> <span class="fl">10</span>,
                        R_sln <span class="op">=</span> <span class="fl">5</span>
                  <span class="op">)</span>,
                  fixed <span class="op">=</span> <span class="cn">TRUE</span>,
                  strata <span class="op">=</span> <span class="st">"sln"</span>,
                  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_sln</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>
            <span class="op">)</span>
      <span class="op">)</span>

<span class="co"># we declare time 0 as a constant and declare tmax</span>
<span class="va">constants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>t0 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">t0</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">70</span>;

<span class="co"># assume there is no transmission in liberia and sierra leone before weeks 10 and 19.</span>
<span class="co"># we encode this using time-varying covariates. </span>
<span class="va">tcovar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">tmax</span>,
                transmission_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">tmax</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,
                transmission_sln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">tmax</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># recovery rates</span>
<span class="va">mu_guin</span> <span class="op">&lt;-</span> <span class="fl">0.9</span>
<span class="va">mu_lib</span> <span class="op">&lt;-</span> <span class="fl">1.1</span>
<span class="va">mu_sln</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="co"># named vector of parameters on their natural scales (i.e., the scale on which they</span>
<span class="co"># enter the rate functions). </span>
<span class="va">parameters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta_guin <span class="op">=</span> <span class="fl">1.2</span> <span class="op">/</span> <span class="va">ep_guin</span> <span class="op">*</span> <span class="va">mu_guin</span>, 
               beta_lib <span class="op">=</span> <span class="fl">1.35</span> <span class="op">/</span> <span class="va">ep_lib</span> <span class="op">*</span> <span class="va">mu_lib</span>,
               beta_sln <span class="op">=</span> <span class="fl">1.45</span> <span class="op">/</span> <span class="va">ep_sln</span> <span class="op">*</span> <span class="va">mu_sln</span>,
               alpha_guin2lib <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_lib</span> <span class="op">*</span> <span class="va">mu_guin</span>,
               alpha_guin2sln <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_sln</span> <span class="op">*</span> <span class="va">mu_guin</span>,
               alpha_lib2guin <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_guin</span> <span class="op">*</span> <span class="va">mu_lib</span>,
               alpha_lib2sln  <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_sln</span> <span class="op">*</span> <span class="va">mu_lib</span>,
               alpha_sln2guin <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_guin</span> <span class="op">*</span> <span class="va">mu_sln</span>,
               alpha_sln2lib  <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_lib</span> <span class="op">*</span> <span class="va">mu_sln</span>,
               omega_guin <span class="op">=</span> <span class="fl">1.2</span>,
               omega_lib <span class="op">=</span> <span class="fl">1</span>,
               omega_sln <span class="op">=</span> <span class="fl">0.8</span>,
               mu_guin <span class="op">=</span> <span class="va">mu_guin</span>,
               mu_lib <span class="op">=</span> <span class="va">mu_lib</span>,
               mu_sln <span class="op">=</span> <span class="va">mu_sln</span>,
               rho_guin <span class="op">=</span> <span class="fl">100</span><span class="op">/</span><span class="fl">150</span>,
               rho_lib <span class="op">=</span> <span class="fl">100</span><span class="op">/</span><span class="fl">175</span>,
               rho_sln <span class="op">=</span> <span class="fl">100</span><span class="op">/</span><span class="fl">125</span>,
               phi_guin <span class="op">=</span> <span class="fl">100</span>,
               phi_lib <span class="op">=</span> <span class="fl">100</span>,
               phi_sln <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="co"># save the true parameters for later</span>
<span class="va">true_pars</span> <span class="op">&lt;-</span> <span class="va">parameters</span>

<span class="co"># initialize the model dynamics</span>
<span class="va">dynamics</span> <span class="op">&lt;-</span>
      <span class="fu"><a href="../reference/stem_dynamics.html">stem_dynamics</a></span><span class="op">(</span>
            rates <span class="op">=</span> <span class="va">rates</span>,
            tmax <span class="op">=</span> <span class="va">tmax</span>,
            timestep <span class="op">=</span> <span class="cn">NULL</span>,
            parameters <span class="op">=</span> <span class="va">parameters</span>,
            state_initializer <span class="op">=</span> <span class="va">state_initializer</span>,
            compartments <span class="op">=</span> <span class="va">compartments</span>,
            constants <span class="op">=</span> <span class="va">constants</span>,
            strata <span class="op">=</span> <span class="va">strata</span>,
            tcovar <span class="op">=</span> <span class="va">tcovar</span>,
            messages <span class="op">=</span> <span class="cn">F</span>,
            compile_ode <span class="op">=</span> <span class="cn">T</span>,
            compile_rates <span class="op">=</span> <span class="cn">T</span>,
            compile_lna <span class="op">=</span> <span class="cn">T</span>,
            rtol <span class="op">=</span> <span class="fl">1e-5</span>,
            atol <span class="op">=</span> <span class="fl">1e-5</span>,
            step_size <span class="op">=</span> <span class="fl">1e-7</span>
      <span class="op">)</span>

<span class="co"># the next step is to initialize the measurement process, see help("emission") for</span>
<span class="co"># additional details on specifying the emission distributions.</span>
<span class="co"># here we have different case detection rates and overdispersions for each country</span>
<span class="va">emissions</span> <span class="op">&lt;-</span>
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
            <span class="fu"><a href="../reference/emission.html">emission</a></span><span class="op">(</span>
                  meas_var <span class="op">=</span> <span class="st">"guin_cases"</span>,
                  distribution <span class="op">=</span> <span class="st">"negbinomial"</span>,
                  emission_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"phi_guin"</span>, <span class="st">"E_guin2I_guin * rho_guin"</span><span class="op">)</span>,
                  incidence <span class="op">=</span> <span class="cn">TRUE</span>,
                  obstimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/emission.html">emission</a></span><span class="op">(</span>
                  meas_var <span class="op">=</span> <span class="st">"lib_cases"</span>,
                  distribution <span class="op">=</span> <span class="st">"negbinomial"</span>,
                  emission_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"phi_lib"</span>, <span class="st">"E_lib2I_lib * rho_lib"</span><span class="op">)</span>,
                  incidence <span class="op">=</span> <span class="cn">TRUE</span>,
                  obstimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
            <span class="op">)</span>,
            <span class="fu"><a href="../reference/emission.html">emission</a></span><span class="op">(</span>
                  meas_var <span class="op">=</span> <span class="st">"sln_cases"</span>,
                  distribution <span class="op">=</span> <span class="st">"negbinomial"</span>,
                  emission_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"phi_sln"</span>, <span class="st">"E_sln2I_sln * rho_sln"</span><span class="op">)</span>,
                  incidence <span class="op">=</span> <span class="cn">TRUE</span>,
                  obstimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">19</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
            <span class="op">)</span>
      <span class="op">)</span>

<span class="co"># compile the measurement process</span>
<span class="va">measurement_process</span> <span class="op">&lt;-</span>
      <span class="fu"><a href="../reference/stem_measure.html">stem_measure</a></span><span class="op">(</span>emissions <span class="op">=</span> <span class="va">emissions</span>,
                   dynamics <span class="op">=</span> <span class="va">dynamics</span>,
                   messages <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co"># put it all together in a stem object - no data since we haven't simulated it yet</span>
<span class="va">stem_object</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/make_stem.html">make_stem</a></span><span class="op">(</span>dynamics <span class="op">=</span> <span class="va">dynamics</span>, 
            measurement_process <span class="op">=</span> <span class="va">measurement_process</span><span class="op">)</span></code></pre></div>
<p>After compiling the model, we simulate an outbreak from the MJP using Gillespie’s direct algorithm as well as the observed incidence.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># simulate the outbreak and dataset - defaults to simulation via the MJP</span>
<span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_stem.html">simulate_stem</a></span><span class="op">(</span><span class="va">stem_object</span><span class="op">)</span>

<span class="co"># save the true path of the outbreak and the data</span>
<span class="va">true_path</span>   <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">paths</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>    <span class="co"># true incidence path</span>
<span class="va">dat</span>         <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">datasets</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># data</span>
<span class="va">total_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># for priors as in Web Appendix G of Fintzi. et al. (2020)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span>

<span class="va">sim_dat</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Guinea"</span>, <span class="st">"Liberia"</span>, <span class="st">"Sierra Leone"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span>,
             Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">tmax</span><span class="op">)</span>,
             Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"True incidence"</span>, <span class="st">"Observed incidence"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">tmax</span><span class="op">)</span>,
             Count <span class="op">=</span> 
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">true_path</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"E_guin2I_guin"</span>,<span class="st">"E_lib2I_lib"</span>, <span class="st">"E_sln2I_sln"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"guin_cases"</span>, <span class="st">"lib_cases"</span>, <span class="st">"sln_cases"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">sim_dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">sim_dat</span>,
                 <span class="op">!</span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"Liberia"</span> <span class="op">&amp;</span> <span class="va">Week</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">&amp;</span> 
                   <span class="op">!</span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"Sierra Leone"</span> <span class="op">&amp;</span> <span class="va">Week</span> <span class="op">&lt;</span> <span class="fl">19</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sim_dat</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Week</span>, y <span class="op">=</span> <span class="va">Count</span>, shape <span class="op">=</span> <span class="va">Type</span>, colour <span class="op">=</span> <span class="va">Country</span>, fill <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"True incidence"</span>, <span class="st">"Observed incidence"</span><span class="op">)</span>,
                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_colour_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># theme(legend.position = "bottom") + </span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">Country</span><span class="op">)</span></code></pre></div>
<p><img src="ebola_westafrica_files/figure-html/plot_sim-1.png" width="768"></p>
</div>
<div id="fitting-the-model-in-stemr-via-the-lna-or-ode-approximations" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-the-model-in-stemr-via-the-lna-or-ode-approximations" class="anchor"></a>Fitting the model in stemr via the LNA or ODE approximations</h1>
<p>We’ll need to recompile the model dynamics and measurement process, both to tweak the model to now estimate the effective population size and to let the package know that we’re going to be fitting the model to data. After that, we’ll specify priors along, along with functions for going to and from the MCMC estimation scale. Details of the priors are given in Web Appendix G of Fintzi, et al. (2020).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12511</span><span class="op">)</span>

<span class="co"># tweaking the rates to accommodate an adjustment to the effective population </span>
<span class="co"># size. effpop_guin, effpop_lib, effpop_sln are the size of the susceptible </span>
<span class="co"># populations in each country that are effectively removed from transmission.</span>
<span class="co"># So, for example, S_guin - effpop_guin is equal to the effective number of </span>
<span class="co"># susceptibles in Guinea</span>

<span class="va">rates</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      rate <span class="op">=</span> <span class="st">"beta_guin * (I_guin + transmission_lib * alpha_lib2guin * I_lib + transmission_sln * alpha_sln2guin * I_sln) * (S_guin - effpop_guin)"</span>,
      from <span class="op">=</span> <span class="st">"S"</span>,
      to <span class="op">=</span> <span class="st">"E"</span>,
      strata <span class="op">=</span> <span class="st">"guin"</span>,
      lumped <span class="op">=</span> <span class="cn">TRUE</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      rate <span class="op">=</span> <span class="st">"transmission_lib * beta_lib * (I_lib + alpha_guin2lib * I_guin + transmission_sln * alpha_sln2lib * I_sln) * (S_lib - effpop_lib)"</span>,
      from <span class="op">=</span> <span class="st">"S"</span>,
      to <span class="op">=</span> <span class="st">"E"</span>,
      strata <span class="op">=</span> <span class="st">"lib"</span>,
      lumped <span class="op">=</span> <span class="cn">TRUE</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      rate <span class="op">=</span> <span class="st">"transmission_sln * beta_sln * (I_sln + alpha_guin2sln * I_guin + transmission_lib * alpha_lib2sln * I_lib) * (S_sln - effpop_sln)"</span>,
      from <span class="op">=</span> <span class="st">"S"</span>,
      to <span class="op">=</span> <span class="st">"E"</span>,
      strata <span class="op">=</span> <span class="st">"sln"</span>,
      lumped <span class="op">=</span> <span class="cn">TRUE</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      rate <span class="op">=</span> <span class="st">"omega_guin"</span>,
      from <span class="op">=</span> <span class="st">"E"</span>,
      to <span class="op">=</span> <span class="st">"I"</span>,
      strata <span class="op">=</span> <span class="st">"guin"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      rate <span class="op">=</span> <span class="st">"transmission_lib * omega_lib"</span>,
      from <span class="op">=</span> <span class="st">"E"</span>,
      to <span class="op">=</span> <span class="st">"I"</span>,
      strata <span class="op">=</span> <span class="st">"lib"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      rate <span class="op">=</span> <span class="st">"transmission_sln * omega_sln"</span>,
      from <span class="op">=</span> <span class="st">"E"</span>,
      to <span class="op">=</span> <span class="st">"I"</span>,
      strata <span class="op">=</span> <span class="st">"sln"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      rate <span class="op">=</span> <span class="st">"mu_guin"</span>,
      from <span class="op">=</span> <span class="st">"I"</span>,
      to <span class="op">=</span> <span class="st">"R"</span>,
      strata <span class="op">=</span> <span class="st">"guin"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      rate <span class="op">=</span> <span class="st">"transmission_lib * mu_lib"</span>,
      from <span class="op">=</span> <span class="st">"I"</span>,
      to <span class="op">=</span> <span class="st">"R"</span>,
      strata <span class="op">=</span> <span class="st">"lib"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      rate <span class="op">=</span> <span class="st">"transmission_sln * mu_sln"</span>,
      from <span class="op">=</span> <span class="st">"I"</span>,
      to <span class="op">=</span> <span class="st">"R"</span>,
      strata <span class="op">=</span> <span class="st">"sln"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>
  <span class="op">)</span>

<span class="co"># initial states, now inferred as parameters in the model</span>
<span class="va">state_initializer</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/stem_initializer.html">stem_initializer</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        S_guin <span class="op">=</span> <span class="va">popsize_guin</span> <span class="op">-</span> <span class="fl">30</span>,
        E_guin <span class="op">=</span> <span class="fl">15</span>,
        I_guin <span class="op">=</span> <span class="fl">10</span>,
        R_guin <span class="op">=</span> <span class="fl">5</span>
      <span class="op">)</span>,
      fixed <span class="op">=</span> <span class="cn">FALSE</span>,
      strata <span class="op">=</span> <span class="st">"guin"</span>,
      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_guin</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/stem_initializer.html">stem_initializer</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        S_lib <span class="op">=</span> <span class="va">popsize_lib</span> <span class="op">-</span> <span class="fl">30</span>,
        E_lib <span class="op">=</span> <span class="fl">15</span>,
        I_lib <span class="op">=</span> <span class="fl">10</span>,
        R_lib <span class="op">=</span> <span class="fl">5</span>
      <span class="op">)</span>,
      fixed <span class="op">=</span> <span class="cn">FALSE</span>,
      strata <span class="op">=</span> <span class="st">"lib"</span>,
      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_lib</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/stem_initializer.html">stem_initializer</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        S_sln <span class="op">=</span> <span class="va">popsize_sln</span> <span class="op">-</span> <span class="fl">30</span>,
        E_sln <span class="op">=</span> <span class="fl">15</span>,
        I_sln <span class="op">=</span> <span class="fl">10</span>,
        R_sln <span class="op">=</span> <span class="fl">5</span>
      <span class="op">)</span>,
      fixed <span class="op">=</span> <span class="cn">FALSE</span>,
      strata <span class="op">=</span> <span class="st">"sln"</span>,
      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_sln</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>

<span class="co"># same assumptions about transmission commencing in liberia and sierra leone</span>
<span class="va">tcovar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">tmax</span>,
                transmission_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">tmax</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,
                transmission_sln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">tmax</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># parameters</span>
<span class="va">parameters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta_guin <span class="op">=</span> <span class="fl">1.25</span> <span class="op">/</span> <span class="va">ep_guin</span> <span class="op">*</span> <span class="va">mu_guin</span>, 
               beta_lib <span class="op">=</span> <span class="fl">1.35</span> <span class="op">/</span> <span class="va">ep_lib</span> <span class="op">*</span> <span class="va">mu_lib</span>,
               beta_sln <span class="op">=</span> <span class="fl">1.45</span> <span class="op">/</span> <span class="va">ep_sln</span> <span class="op">*</span> <span class="va">mu_sln</span>,
               alpha_guin2lib <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_lib</span> <span class="op">*</span> <span class="va">mu_guin</span>,
               alpha_guin2sln <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_sln</span> <span class="op">*</span> <span class="va">mu_guin</span>,
               alpha_lib2guin <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_guin</span> <span class="op">*</span> <span class="va">mu_lib</span>,
               alpha_lib2sln  <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_sln</span> <span class="op">*</span> <span class="va">mu_lib</span>,
               alpha_sln2guin <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_guin</span> <span class="op">*</span> <span class="va">mu_sln</span>,
               alpha_sln2lib  <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_lib</span> <span class="op">*</span> <span class="va">mu_sln</span>,
               effpop_guin <span class="op">=</span> <span class="va">popsize_guin</span> <span class="op">-</span> <span class="va">ep_guin</span>,
               effpop_lib <span class="op">=</span> <span class="va">popsize_lib</span> <span class="op">-</span> <span class="va">ep_lib</span>,
               effpop_sln <span class="op">=</span> <span class="va">popsize_sln</span> <span class="op">-</span> <span class="va">ep_sln</span>,
               omega_guin <span class="op">=</span> <span class="fl">1</span>,
               omega_lib <span class="op">=</span> <span class="fl">1</span>,
               omega_sln <span class="op">=</span> <span class="fl">1</span>,
               mu_guin <span class="op">=</span> <span class="va">mu_guin</span>,
               mu_lib <span class="op">=</span> <span class="va">mu_lib</span>,
               mu_sln <span class="op">=</span> <span class="va">mu_sln</span>,
               rho_guin <span class="op">=</span> <span class="fl">100</span><span class="op">/</span><span class="fl">150</span>,
               rho_lib <span class="op">=</span> <span class="fl">100</span><span class="op">/</span><span class="fl">175</span>,
               rho_sln <span class="op">=</span> <span class="fl">100</span><span class="op">/</span><span class="fl">125</span>,
               phi_guin <span class="op">=</span> <span class="fl">50</span>,
               phi_lib <span class="op">=</span> <span class="fl">50</span>,
               phi_sln <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>

<span class="co"># declare t0 as a constant</span>
<span class="va">constants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>t0 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">t0</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>;

<span class="co"># compile the dynamics</span>
<span class="va">dynamics</span> <span class="op">&lt;-</span>
      <span class="fu"><a href="../reference/stem_dynamics.html">stem_dynamics</a></span><span class="op">(</span>
            rates <span class="op">=</span> <span class="va">rates</span>,
            tmax <span class="op">=</span> <span class="va">tmax</span>,
            timestep <span class="op">=</span> <span class="cn">NULL</span>,
            parameters <span class="op">=</span> <span class="va">parameters</span>,
            state_initializer <span class="op">=</span> <span class="va">state_initializer</span>,
            compartments <span class="op">=</span> <span class="va">compartments</span>,
            constants <span class="op">=</span> <span class="va">constants</span>,
            strata <span class="op">=</span> <span class="va">strata</span>,
            tcovar <span class="op">=</span> <span class="va">tcovar</span>,
            messages <span class="op">=</span> <span class="cn">F</span>,
            compile_ode <span class="op">=</span> <span class="cn">T</span>,
            compile_rates <span class="op">=</span> <span class="cn">T</span>,
            compile_lna <span class="op">=</span> <span class="cn">T</span>,
            rtol <span class="op">=</span> <span class="fl">1e-5</span>,
            atol <span class="op">=</span> <span class="fl">1e-5</span>,
            step_size <span class="op">=</span> <span class="fl">1e-7</span>
      <span class="op">)</span>

<span class="co"># compile the measurement process</span>
<span class="va">emissions</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/emission.html">emission</a></span><span class="op">(</span>
      meas_var <span class="op">=</span> <span class="st">"guin_cases"</span>,
      distribution <span class="op">=</span> <span class="st">"negbinomial"</span>,
      emission_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"phi_guin"</span>, <span class="st">"E_guin2I_guin * rho_guin"</span><span class="op">)</span>,
      incidence <span class="op">=</span> <span class="cn">TRUE</span>,
      obstimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/emission.html">emission</a></span><span class="op">(</span>
      meas_var <span class="op">=</span> <span class="st">"lib_cases"</span>,
      distribution <span class="op">=</span> <span class="st">"negbinomial"</span>,
      emission_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"phi_lib"</span>, <span class="st">"E_lib2I_lib * rho_lib"</span><span class="op">)</span>,
      incidence <span class="op">=</span> <span class="cn">TRUE</span>,
      obstimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/emission.html">emission</a></span><span class="op">(</span>
      meas_var <span class="op">=</span> <span class="st">"sln_cases"</span>,
      distribution <span class="op">=</span> <span class="st">"negbinomial"</span>,
      emission_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"phi_sln"</span>, <span class="st">"E_sln2I_sln * rho_sln"</span><span class="op">)</span>,
      incidence <span class="op">=</span> <span class="cn">TRUE</span>,
      obstimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">19</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>

<span class="co"># recompile stemr object</span>
<span class="va">measurement_process</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/stem_measure.html">stem_measure</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">dat</span>,
    emissions <span class="op">=</span> <span class="va">emissions</span>,
    dynamics <span class="op">=</span> <span class="va">dynamics</span>,
    messages <span class="op">=</span> <span class="cn">F</span>
  <span class="op">)</span>

<span class="va">stem_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_stem.html">make_stem</a></span><span class="op">(</span>dynamics <span class="op">=</span> <span class="va">dynamics</span>, 
                    measurement_process <span class="op">=</span> <span class="va">measurement_process</span><span class="op">)</span>

<span class="co">#### initialize the inference</span>
<span class="va">popsizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_guin</span>, <span class="va">popsize_lib</span>, <span class="va">popsize_sln</span><span class="op">)</span>

<span class="co"># to and from the MCMC estimation scale</span>
<span class="va">to_est_scale_guin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_nat</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">l_effpop</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_guin</span> <span class="op">-</span> <span class="va">params_nat</span><span class="op">[[</span><span class="st">"effpop_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Neff_x_rho</span> <span class="op">&lt;-</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_infec_dur</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"mu_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">expm1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"beta_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> 
                              <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    log_Reff_guin_o <span class="op">=</span> <span class="va">l_Reff_m1</span> <span class="op">+</span> <span class="va">l_Neff_x_rho</span>,
    log_Rext_g2l <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_guin2lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Rext_g2s <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_guin2sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Neff_x_rho_guin <span class="op">=</span> <span class="va">l_Neff_x_rho</span>,
    log_omega_d_mu_guin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"omega_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">l_infec_dur</span>,
    log_infec_dur_guin <span class="op">=</span> <span class="va">l_infec_dur</span>,
    logit_rho_guin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_sqrt_phi_inv_guin <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"phi_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">from_est_scale_guin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">rho</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span>  <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_guin"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_guin_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_guin"</span><span class="op">]</span><span class="op">]</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    beta_guin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_Reff_m1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">l_effpop</span> <span class="op">-</span>
                      <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_guin2lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2l"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_guin2sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2s"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    effpop_guin <span class="op">=</span> <span class="va">popsize_guin</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_effpop</span><span class="op">)</span>,
    omega_guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_guin"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    mu_guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    rho_guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    phi_guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">logprior_guin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">rho</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_guin"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_guin_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_guin"</span><span class="op">]</span><span class="op">]</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fl">1.08</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2l"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2l"</span><span class="op">]</span><span class="op">]</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2s"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2s"</span><span class="op">]</span><span class="op">]</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">l_effpop</span>, <span class="fl">9.8</span>, <span class="fl">0.62</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_guin"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_guin"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0.85</span>, <span class="fl">0.75</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0.69</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_guin"</span><span class="op">]</span><span class="op">]</span>
      <span class="op">)</span>
<span class="op">}</span>

<span class="va">to_est_scale_lib</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_nat</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">l_effpop</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_lib</span> <span class="op">-</span> <span class="va">params_nat</span><span class="op">[[</span><span class="st">"effpop_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Neff_x_rho</span> <span class="op">&lt;-</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_infec_dur</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"mu_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">expm1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"beta_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> 
                              <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    log_Reff_lib_o <span class="op">=</span> <span class="va">l_Reff_m1</span> <span class="op">+</span> <span class="va">l_Neff_x_rho</span>,
    log_Rext_l2g <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_lib2guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Rext_l2s <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_lib2sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Neff_x_rho_lib <span class="op">=</span> <span class="va">l_Neff_x_rho</span>,
    log_omega_d_mu_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"omega_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">l_infec_dur</span>,
    log_infec_dur_lib <span class="op">=</span> <span class="va">l_infec_dur</span>,
    logit_rho_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_sqrt_phi_inv_lib <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"phi_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">from_est_scale_lib</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">rho</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span>  <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_lib"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_lib_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_lib"</span><span class="op">]</span><span class="op">]</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    beta_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_Reff_m1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">l_effpop</span> <span class="op">-</span>
                      <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_lib2guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2g"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_lib2sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2s"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    effpop_lib <span class="op">=</span> <span class="va">popsize_lib</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_effpop</span><span class="op">)</span>,
    omega_lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_lib"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    mu_lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    rho_lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    phi_lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">logprior_lib</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">rho</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_lib"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_lib_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_lib"</span><span class="op">]</span><span class="op">]</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fl">1.08</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2g"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2g"</span><span class="op">]</span><span class="op">]</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2s"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2s"</span><span class="op">]</span><span class="op">]</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">l_effpop</span>, <span class="fl">10.5</span>, <span class="fl">0.62</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_lib"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_lib"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0.85</span>, <span class="fl">0.75</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0.69</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_lib"</span><span class="op">]</span><span class="op">]</span>
      <span class="op">)</span>
<span class="op">}</span>

<span class="va">to_est_scale_sln</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_nat</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">l_effpop</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_sln</span> <span class="op">-</span> <span class="va">params_nat</span><span class="op">[[</span><span class="st">"effpop_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Neff_x_rho</span> <span class="op">&lt;-</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_infec_dur</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"mu_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">expm1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"beta_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> 
                              <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    log_Reff_sln_o <span class="op">=</span> <span class="va">l_Reff_m1</span> <span class="op">+</span> <span class="va">l_Neff_x_rho</span>,
    log_Rext_s2g <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_sln2guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Rext_s2l <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_sln2lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Neff_x_rho_sln <span class="op">=</span> <span class="va">l_Neff_x_rho</span>,
    log_omega_d_mu_sln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"omega_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">l_infec_dur</span>,
    log_infec_dur_sln <span class="op">=</span> <span class="va">l_infec_dur</span>,
    logit_rho_sln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_sqrt_phi_inv_sln <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"phi_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">from_est_scale_sln</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">rho</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span>  <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_sln"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_sln_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_sln"</span><span class="op">]</span><span class="op">]</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    beta_sln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_Reff_m1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">l_effpop</span> <span class="op">-</span>
                      <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_sln2guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2g"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_sln2lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2l"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    effpop_sln <span class="op">=</span> <span class="va">popsize_sln</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_effpop</span><span class="op">)</span>,
    omega_sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_sln"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    mu_sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    rho_sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    phi_sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">logprior_sln</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">rho</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_sln"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_sln_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_sln"</span><span class="op">]</span><span class="op">]</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fl">1.08</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2g"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2g"</span><span class="op">]</span><span class="op">]</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2l"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2l"</span><span class="op">]</span><span class="op">]</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">l_effpop</span>, <span class="fl">10.6</span>, <span class="fl">0.62</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_sln"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_sln"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0.85</span>, <span class="fl">0.75</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0.69</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_sln"</span><span class="op">]</span><span class="op">]</span>
      <span class="op">)</span>
<span class="op">}</span>

<span class="va">mcmc_kern</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/mcmc_kernel.html">mcmc_kernel</a></span><span class="op">(</span>
    parameter_blocks <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        <span class="fu"><a href="../reference/parblock.html">parblock</a></span><span class="op">(</span>pars_nat <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_guin"</span>, 
                     <span class="st">"alpha_guin2lib"</span>,
                     <span class="st">"alpha_guin2sln"</span>,
                     <span class="st">"effpop_guin"</span>,
                     <span class="st">"omega_guin"</span>,
                     <span class="st">"mu_guin"</span>,
                     <span class="st">"rho_guin"</span>,
                     <span class="st">"phi_guin"</span><span class="op">)</span>,
                 pars_est <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log_Reff_guin_o"</span>,
                     <span class="st">"log_Rext_g2l"</span>,
                     <span class="st">"log_Rext_g2s"</span>,
                     <span class="st">"log_Neff_x_rho_guin"</span>,
                     <span class="st">"log_omega_d_mu_guin"</span>,
                     <span class="st">"log_infec_dur_guin"</span>,
                     <span class="st">"logit_rho_guin"</span>,
                     <span class="st">"log_sqrt_phi_inv_guin"</span><span class="op">)</span>,
                 priors <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>logprior <span class="op">=</span> <span class="va">logprior_guin</span>,
                        to_estimation_scale <span class="op">=</span> <span class="va">to_est_scale_guin</span>,
                        from_estimation_scale <span class="op">=</span> <span class="va">from_est_scale_guin</span><span class="op">)</span>,
                 alg <span class="op">=</span> <span class="st">"mvnss"</span>,
                 sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,
                 initializer <span class="op">=</span> 
                   <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
                     <span class="fu">from_est_scale_guin</span><span class="op">(</span>
                       <span class="fu">to_est_scale_guin</span><span class="op">(</span>
                         <span class="va">parameters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_guin"</span>, 
                                      <span class="st">"alpha_guin2lib"</span>,
                                      <span class="st">"alpha_guin2sln"</span>,
                                      <span class="st">"effpop_guin"</span>,
                                      <span class="st">"omega_guin"</span>,
                                      <span class="st">"mu_guin"</span>,
                                      <span class="st">"rho_guin"</span>,
                                      <span class="st">"phi_guin"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
                   <span class="op">}</span>, 
                 control <span class="op">=</span> 
                   <span class="fu"><a href="../reference/mvnss_control.html">mvnss_control</a></span><span class="op">(</span>scale_constant <span class="op">=</span> <span class="fl">0.5</span>,
                                 scale_cooling <span class="op">=</span> <span class="fl">0.7</span>,
                                 stop_adaptation <span class="op">=</span> <span class="fl">5e4</span>,
                                 step_size <span class="op">=</span> <span class="fl">0.5</span>,
                                 nugget <span class="op">=</span> <span class="fl">1e-5</span>, 
                                 nugget_step_size <span class="op">=</span> <span class="fl">0.001</span>,
                                 nugget_cooling <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span>,
        <span class="fu"><a href="../reference/parblock.html">parblock</a></span><span class="op">(</span>pars_nat <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_lib"</span>, 
                     <span class="st">"alpha_lib2guin"</span>,
                     <span class="st">"alpha_lib2sln"</span>,
                     <span class="st">"effpop_lib"</span>,
                     <span class="st">"omega_lib"</span>,
                     <span class="st">"mu_lib"</span>,
                     <span class="st">"rho_lib"</span>,
                     <span class="st">"phi_lib"</span><span class="op">)</span>,
                 pars_est <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log_Reff_lib_o"</span>,
                     <span class="st">"log_Rext_l2g"</span>,
                     <span class="st">"log_Rext_l2s"</span>,
                     <span class="st">"log_Neff_x_rho_lib"</span>,
                     <span class="st">"log_omega_d_mu_lib"</span>,
                     <span class="st">"log_infec_dur_lib"</span>,
                     <span class="st">"logit_rho_lib"</span>,
                     <span class="st">"log_sqrt_phi_inv_lib"</span><span class="op">)</span>,
                 priors <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>logprior <span class="op">=</span> <span class="va">logprior_lib</span>,
                        to_estimation_scale <span class="op">=</span> <span class="va">to_est_scale_lib</span>,
                        from_estimation_scale <span class="op">=</span> <span class="va">from_est_scale_lib</span><span class="op">)</span>,
                 alg <span class="op">=</span> <span class="st">"mvnss"</span>,
                 sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,
                 initializer <span class="op">=</span> 
                   <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
                     <span class="fu">from_est_scale_lib</span><span class="op">(</span>
                       <span class="fu">to_est_scale_lib</span><span class="op">(</span>
                         <span class="va">parameters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_lib"</span>, 
                                      <span class="st">"alpha_lib2guin"</span>,
                                      <span class="st">"alpha_lib2sln"</span>,
                                      <span class="st">"effpop_lib"</span>,
                                      <span class="st">"omega_lib"</span>,
                                      <span class="st">"mu_lib"</span>,
                                      <span class="st">"rho_lib"</span>,
                                      <span class="st">"phi_lib"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
                   <span class="op">}</span>, 
                 control <span class="op">=</span> 
                   <span class="fu"><a href="../reference/mvnss_control.html">mvnss_control</a></span><span class="op">(</span>scale_constant <span class="op">=</span> <span class="fl">0.5</span>,
                                 scale_cooling <span class="op">=</span> <span class="fl">0.7</span>,
                                 stop_adaptation <span class="op">=</span> <span class="fl">5e4</span>,
                                 step_size <span class="op">=</span> <span class="fl">0.5</span>,
                                 nugget <span class="op">=</span> <span class="fl">1e-5</span>, 
                                 nugget_step_size <span class="op">=</span> <span class="fl">0.001</span>,
                                 nugget_cooling <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span>,
        <span class="fu"><a href="../reference/parblock.html">parblock</a></span><span class="op">(</span>pars_nat <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_sln"</span>, 
                     <span class="st">"alpha_sln2guin"</span>,
                     <span class="st">"alpha_sln2lib"</span>,
                     <span class="st">"effpop_sln"</span>,
                     <span class="st">"omega_sln"</span>,
                     <span class="st">"mu_sln"</span>,
                     <span class="st">"rho_sln"</span>,
                     <span class="st">"phi_sln"</span><span class="op">)</span>,
                 pars_est <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log_Reff_sln_o"</span>,
                     <span class="st">"log_Rext_s2g"</span>,
                     <span class="st">"log_Rext_s2l"</span>,
                     <span class="st">"log_Neff_x_rho_sln"</span>,
                     <span class="st">"log_omega_d_mu_sln"</span>,
                     <span class="st">"log_infec_dur_sln"</span>,
                     <span class="st">"logit_rho_sln"</span>,
                     <span class="st">"log_sqrt_phi_inv_sln"</span><span class="op">)</span>,
                 priors <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>logprior <span class="op">=</span> <span class="va">logprior_sln</span>,
                        to_estimation_scale <span class="op">=</span> <span class="va">to_est_scale_sln</span>,
                        from_estimation_scale <span class="op">=</span> <span class="va">from_est_scale_sln</span><span class="op">)</span>,
                 alg <span class="op">=</span> <span class="st">"mvnss"</span>,
                 sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,
                 initializer <span class="op">=</span> 
                   <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
                     <span class="fu">from_est_scale_sln</span><span class="op">(</span>
                       <span class="fu">to_est_scale_sln</span><span class="op">(</span>
                         <span class="va">parameters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_sln"</span>, 
                                      <span class="st">"alpha_sln2guin"</span>,
                                      <span class="st">"alpha_sln2lib"</span>,
                                      <span class="st">"effpop_sln"</span>,
                                      <span class="st">"omega_sln"</span>,
                                      <span class="st">"mu_sln"</span>,
                                      <span class="st">"rho_sln"</span>,
                                      <span class="st">"phi_sln"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
                   <span class="op">}</span>, 
                 control <span class="op">=</span> 
                   <span class="fu"><a href="../reference/mvnss_control.html">mvnss_control</a></span><span class="op">(</span>scale_constant <span class="op">=</span> <span class="fl">0.5</span>,
                                 scale_cooling <span class="op">=</span> <span class="fl">0.7</span>,
                                 stop_adaptation <span class="op">=</span> <span class="fl">5e4</span>,
                                 step_size <span class="op">=</span> <span class="fl">0.5</span>,
                                 nugget <span class="op">=</span> <span class="fl">1e-5</span>, 
                                 nugget_step_size <span class="op">=</span> <span class="fl">0.001</span>,
                                 nugget_cooling <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    lna_ess_control <span class="op">=</span> <span class="fu"><a href="../reference/lna_control.html">lna_control</a></span><span class="op">(</span>bracket_update_iter <span class="op">=</span> <span class="fl">5e3</span>,
                                  joint_initdist_update <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We are now ready to fit the model. For the purpose of this vignette, we’ll set the inference method to “ode”. Fitting the model via the LNA only requires that the method be set to “lna”.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fit the model</span>
<span class="va">res</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/fit_stem.html">fit_stem</a></span><span class="op">(</span>stem_object <span class="op">=</span> <span class="va">stem_object</span>,
                 method <span class="op">=</span> <span class="st">"ode"</span>, <span class="co"># or set to "ode"</span>
                 iterations <span class="op">=</span> <span class="fl">1.5e5</span>,
                 thinning_interval <span class="op">=</span> <span class="fl">50</span>,
                 mcmc_kern <span class="op">=</span> <span class="va">mcmc_kern</span>,
                 print_progress <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>The <code>stem_inference</code> function returns a list of MCMC samples, latent epidemic paths, and MCMC tuning parameters (e.g., global scaling parameter adapted in the MCMC). These can be accessed as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">runtime</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">runtime</span>
<span class="va">posterior</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">posterior</span> <span class="co"># list with posterior objects</span></code></pre></div>
</div>
<div id="fitting-the-model-to-data-from-the-2014-2015-west-africa-outbreak" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-the-model-to-data-from-the-2014-2015-west-africa-outbreak" class="anchor"></a>Fitting the model to data from the 2014-2015 West Africa outbreak</h1>
<p>National level WHO incidence counts from the 2014-2015 Ebola outbreak in West Africa are included in the package and may be accessed via <code><a href="https://rdrr.io/r/utils/data.html">data("ebola")</a></code> after the package is loaded. The only changes vis-a-vis the simulation code shown above were to the outbreak length (73 vs. 70 weeks) and to the priors for the effective population sizes, which were tuned by inflating the observed outbreak sizes by some crude estimates of the case detection ratio to match the expected outbreak sizes under our priors for the basic reproduction number. This is further explained in Web Appendices of Fintzi, et al. (2020).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"ebola"</span><span class="op">)</span>
<span class="va">dat</span> <span class="op">=</span> <span class="va">ebola</span>; <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">ebola</span><span class="op">)</span> <span class="co"># just renaming</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"guin_cases"</span>, <span class="st">"lib_cases"</span>, <span class="st">"sln_cases"</span><span class="op">)</span>
<span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>

<span class="va">popsize_guin</span> <span class="op">&lt;-</span> <span class="fl">11.8e6</span>
<span class="va">popsize_lib</span> <span class="op">&lt;-</span> <span class="fl">4.4e6</span>
<span class="va">popsize_sln</span> <span class="op">&lt;-</span> <span class="fl">7.1e6</span>

<span class="va">log_popsize_guin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_guin</span><span class="op">)</span>
<span class="va">log_popsize_lib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_lib</span><span class="op">)</span>
<span class="va">log_popsize_sln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_sln</span><span class="op">)</span>

<span class="co"># stemr object separate dynamics for all countries --------------------------------------------------</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12511</span><span class="op">)</span>
<span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"guin"</span>, <span class="st">"lib"</span>, <span class="st">"sln"</span><span class="op">)</span>
<span class="va">compartments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>S <span class="op">=</span> <span class="st">"ALL"</span>, E <span class="op">=</span> <span class="st">"ALL"</span>, I <span class="op">=</span> <span class="st">"ALL"</span>, R <span class="op">=</span> <span class="st">"ALL"</span><span class="op">)</span>

<span class="co"># rates</span>
<span class="va">rates</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      <span class="st">"beta_guin * (I_guin + transmission_lib * alpha_lib2guin * I_lib + transmission_sln * alpha_sln2guin * I_sln) * (S_guin - effpop_guin)"</span>,
      from <span class="op">=</span> <span class="st">"S"</span>,
      to <span class="op">=</span> <span class="st">"E"</span>,
      strata <span class="op">=</span> <span class="st">"guin"</span>,
      lumped <span class="op">=</span> <span class="cn">TRUE</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      <span class="st">"transmission_lib * beta_lib * (I_lib + alpha_guin2lib * I_guin + transmission_sln * alpha_sln2lib * I_sln) * (S_lib - effpop_lib)"</span>,
      from <span class="op">=</span> <span class="st">"S"</span>,
      to <span class="op">=</span> <span class="st">"E"</span>,
      strata <span class="op">=</span> <span class="st">"lib"</span>,
      lumped <span class="op">=</span> <span class="cn">TRUE</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      <span class="st">"transmission_sln * beta_sln * (I_sln + alpha_guin2sln * I_guin + transmission_lib * alpha_lib2sln * I_lib) * (S_sln - effpop_sln)"</span>,
      from <span class="op">=</span> <span class="st">"S"</span>,
      to <span class="op">=</span> <span class="st">"E"</span>,
      strata <span class="op">=</span> <span class="st">"sln"</span>,
      lumped <span class="op">=</span> <span class="cn">TRUE</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      <span class="st">"omega_guin"</span>,
      from <span class="op">=</span> <span class="st">"E"</span>,
      to <span class="op">=</span> <span class="st">"I"</span>,
      strata <span class="op">=</span> <span class="st">"guin"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      <span class="st">"transmission_lib * omega_lib"</span>,
      from <span class="op">=</span> <span class="st">"E"</span>,
      to <span class="op">=</span> <span class="st">"I"</span>,
      strata <span class="op">=</span> <span class="st">"lib"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      <span class="st">"transmission_sln * omega_sln"</span>,
      from <span class="op">=</span> <span class="st">"E"</span>,
      to <span class="op">=</span> <span class="st">"I"</span>,
      strata <span class="op">=</span> <span class="st">"sln"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      <span class="st">"mu_guin"</span>,
      from <span class="op">=</span> <span class="st">"I"</span>,
      to <span class="op">=</span> <span class="st">"R"</span>,
      strata <span class="op">=</span> <span class="st">"guin"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      <span class="st">"transmission_lib * mu_lib"</span>,
      from <span class="op">=</span> <span class="st">"I"</span>,
      to <span class="op">=</span> <span class="st">"R"</span>,
      strata <span class="op">=</span> <span class="st">"lib"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/rate.html">rate</a></span><span class="op">(</span>
      <span class="st">"transmission_sln * mu_sln"</span>,
      from <span class="op">=</span> <span class="st">"I"</span>,
      to <span class="op">=</span> <span class="st">"R"</span>,
      strata <span class="op">=</span> <span class="st">"sln"</span>,
      incidence <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>
  <span class="op">)</span>

<span class="co"># initial state</span>

<span class="va">state_initializer</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/stem_initializer.html">stem_initializer</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        S_guin <span class="op">=</span> <span class="va">popsize_guin</span> <span class="op">-</span> <span class="fl">30</span>,
        E_guin <span class="op">=</span> <span class="fl">15</span>,
        I_guin <span class="op">=</span> <span class="fl">10</span>,
        R_guin <span class="op">=</span> <span class="fl">5</span>
      <span class="op">)</span>,
      fixed <span class="op">=</span> <span class="cn">FALSE</span>,
      strata <span class="op">=</span> <span class="st">"guin"</span>,
      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_guin</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/stem_initializer.html">stem_initializer</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        S_lib <span class="op">=</span> <span class="va">popsize_lib</span> <span class="op">-</span> <span class="fl">30</span>,
        E_lib <span class="op">=</span> <span class="fl">15</span>,
        I_lib <span class="op">=</span> <span class="fl">10</span>,
        R_lib <span class="op">=</span> <span class="fl">5</span>
      <span class="op">)</span>,
      fixed <span class="op">=</span> <span class="cn">FALSE</span>,
      strata <span class="op">=</span> <span class="st">"lib"</span>,
      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_lib</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/stem_initializer.html">stem_initializer</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        S_sln <span class="op">=</span> <span class="va">popsize_sln</span> <span class="op">-</span> <span class="fl">30</span>,
        E_sln <span class="op">=</span> <span class="fl">15</span>,
        I_sln <span class="op">=</span> <span class="fl">10</span>,
        R_sln <span class="op">=</span> <span class="fl">5</span>
      <span class="op">)</span>,
      fixed <span class="op">=</span> <span class="cn">FALSE</span>,
      strata <span class="op">=</span> <span class="st">"sln"</span>,
      prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_sln</span> <span class="op">-</span> <span class="fl">30</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>

<span class="co"># time varying covariates</span>
<span class="va">tcovar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">tmax</span>,
                transmission_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">tmax</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,
                transmission_sln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">tmax</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># effective population sizes</span>
<span class="va">ep_guin</span> <span class="op">&lt;-</span> <span class="fl">1.5e4</span>
<span class="va">ep_lib</span>  <span class="op">&lt;-</span> <span class="fl">3e4</span>
<span class="va">ep_sln</span>  <span class="op">&lt;-</span> <span class="fl">4.5e4</span>

<span class="va">parameters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta_guin <span class="op">=</span> <span class="fl">1.25</span> <span class="op">/</span> <span class="va">ep_guin</span>,
               beta_lib <span class="op">=</span> <span class="fl">1.5</span> <span class="op">/</span> <span class="va">ep_lib</span>,
               beta_sln <span class="op">=</span> <span class="fl">1.5</span> <span class="op">/</span> <span class="va">ep_sln</span>,
               alpha_guin2lib <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_lib</span>,
               alpha_guin2sln <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_sln</span>,
               alpha_lib2guin <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_guin</span>,
               alpha_lib2sln  <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_sln</span>,
               alpha_sln2guin <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_guin</span>,
               alpha_sln2lib  <span class="op">=</span> <span class="fl">0.02</span> <span class="op">/</span> <span class="va">ep_lib</span>,
               effpop_guin <span class="op">=</span> <span class="va">popsize_guin</span> <span class="op">-</span> <span class="va">ep_guin</span>,
               effpop_lib <span class="op">=</span> <span class="va">popsize_lib</span> <span class="op">-</span> <span class="va">ep_lib</span>,
               effpop_sln <span class="op">=</span> <span class="va">popsize_sln</span> <span class="op">-</span> <span class="va">ep_sln</span>,
               omega_guin <span class="op">=</span> <span class="fl">1</span>,
               omega_lib <span class="op">=</span> <span class="fl">1</span>,
               omega_sln <span class="op">=</span> <span class="fl">1</span>,
               mu_guin <span class="op">=</span> <span class="fl">1</span>,
               mu_lib <span class="op">=</span> <span class="fl">1</span>,
               mu_sln <span class="op">=</span> <span class="fl">1</span>,
               rho_guin <span class="op">=</span> <span class="fl">0.75</span>,
               rho_lib <span class="op">=</span> <span class="fl">0.75</span>,
               rho_sln <span class="op">=</span> <span class="fl">0.75</span>,
               phi_guin <span class="op">=</span> <span class="fl">10</span>,
               phi_lib <span class="op">=</span> <span class="fl">10</span>,
               phi_sln <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">constants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>t0 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">t0</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>;

<span class="va">dynamics</span> <span class="op">&lt;-</span>
      <span class="fu"><a href="../reference/stem_dynamics.html">stem_dynamics</a></span><span class="op">(</span>
            rates <span class="op">=</span> <span class="va">rates</span>,
            tmax <span class="op">=</span> <span class="va">tmax</span>,
            timestep <span class="op">=</span> <span class="cn">NULL</span>,
            parameters <span class="op">=</span> <span class="va">parameters</span>,
            state_initializer <span class="op">=</span> <span class="va">state_initializer</span>,
            compartments <span class="op">=</span> <span class="va">compartments</span>,
            constants <span class="op">=</span> <span class="va">constants</span>,
            strata <span class="op">=</span> <span class="va">strata</span>,
            tcovar <span class="op">=</span> <span class="va">tcovar</span>,
            messages <span class="op">=</span> <span class="cn">F</span>,
            compile_ode <span class="op">=</span> <span class="cn">T</span>,
            compile_rates <span class="op">=</span> <span class="cn">T</span>,
            compile_lna <span class="op">=</span> <span class="cn">T</span>,
            rtol <span class="op">=</span> <span class="fl">1e-5</span>,
            atol <span class="op">=</span> <span class="fl">1e-5</span>,
            step_size <span class="op">=</span> <span class="fl">1e-6</span>
      <span class="op">)</span>

<span class="co"># emission distribution</span>
<span class="va">emissions</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/emission.html">emission</a></span><span class="op">(</span>
      <span class="st">"guin_cases"</span>,
      <span class="st">"negbinomial"</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"phi_guin"</span>, <span class="st">"E_guin2I_guin * rho_guin"</span><span class="op">)</span>,
      incidence <span class="op">=</span> <span class="cn">TRUE</span>,
      obstimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/emission.html">emission</a></span><span class="op">(</span>
      <span class="st">"lib_cases"</span>,
      <span class="st">"negbinomial"</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"phi_lib"</span>, <span class="st">"E_lib2I_lib * rho_lib"</span><span class="op">)</span>,
      incidence <span class="op">=</span> <span class="cn">TRUE</span>,
      obstimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/emission.html">emission</a></span><span class="op">(</span>
      <span class="st">"sln_cases"</span>,
      <span class="st">"negbinomial"</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"phi_sln"</span>, <span class="st">"E_sln2I_sln * rho_sln"</span><span class="op">)</span>,
      incidence <span class="op">=</span> <span class="cn">TRUE</span>,
      obstimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">19</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>

<span class="co"># recompile stemr object</span>
<span class="va">measurement_process</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/stem_measure.html">stem_measure</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>, 
               emissions <span class="op">=</span> <span class="va">emissions</span>, 
               dynamics <span class="op">=</span> <span class="va">dynamics</span>, 
               messages <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="va">stem_object</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/make_stem.html">make_stem</a></span><span class="op">(</span>dynamics <span class="op">=</span> <span class="va">dynamics</span>, 
            measurement_process <span class="op">=</span> <span class="va">measurement_process</span><span class="op">)</span>

<span class="co">#### initialize the MCMC objects</span>
<span class="va">popsizes</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">popsize_guin</span>, <span class="va">popsize_lib</span>, <span class="va">popsize_sln</span><span class="op">)</span>

<span class="co"># to and from the MCMC estimation scale</span>
<span class="va">to_est_scale_guin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_nat</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">l_effpop</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_guin</span> <span class="op">-</span> <span class="va">params_nat</span><span class="op">[[</span><span class="st">"effpop_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Neff_x_rho</span> <span class="op">&lt;-</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_infec_dur</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"mu_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">expm1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"beta_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> 
                              <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    log_Reff_guin_o <span class="op">=</span> <span class="va">l_Reff_m1</span> <span class="op">+</span> <span class="va">l_Neff_x_rho</span>,
    log_Rext_g2l <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_guin2lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Rext_g2s <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_guin2sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Neff_x_rho_guin <span class="op">=</span> <span class="va">l_Neff_x_rho</span>,
    log_omega_d_mu_guin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"omega_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">l_infec_dur</span>,
    log_infec_dur_guin <span class="op">=</span> <span class="va">l_infec_dur</span>,
    logit_rho_guin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_sqrt_phi_inv_guin <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"phi_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">from_est_scale_guin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">rho</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span>  <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_guin"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_guin_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_guin"</span><span class="op">]</span><span class="op">]</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    beta_guin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_Reff_m1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">l_effpop</span> <span class="op">-</span>
                      <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_guin2lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2l"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_guin2sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2s"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    effpop_guin <span class="op">=</span> <span class="va">popsize_guin</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_effpop</span><span class="op">)</span>,
    omega_guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_guin"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    mu_guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    rho_guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    phi_guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">logprior_guin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">rho</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_guin"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_guin_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_guin"</span><span class="op">]</span><span class="op">]</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fl">1.08</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2l"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2l"</span><span class="op">]</span><span class="op">]</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2s"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_g2s"</span><span class="op">]</span><span class="op">]</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">l_effpop</span>, <span class="fl">9.6</span>, <span class="fl">0.62</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_guin"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_guin"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_guin"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0.85</span>, <span class="fl">0.75</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0.69</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_guin"</span><span class="op">]</span><span class="op">]</span>
      <span class="op">)</span>
<span class="op">}</span>

<span class="va">to_est_scale_lib</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_nat</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">l_effpop</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_lib</span> <span class="op">-</span> <span class="va">params_nat</span><span class="op">[[</span><span class="st">"effpop_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Neff_x_rho</span> <span class="op">&lt;-</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_infec_dur</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"mu_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">expm1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"beta_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> 
                              <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    log_Reff_lib_o <span class="op">=</span> <span class="va">l_Reff_m1</span> <span class="op">+</span> <span class="va">l_Neff_x_rho</span>,
    log_Rext_l2g <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_lib2guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Rext_l2s <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_lib2sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Neff_x_rho_lib <span class="op">=</span> <span class="va">l_Neff_x_rho</span>,
    log_omega_d_mu_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"omega_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">l_infec_dur</span>,
    log_infec_dur_lib <span class="op">=</span> <span class="va">l_infec_dur</span>,
    logit_rho_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_sqrt_phi_inv_lib <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"phi_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">from_est_scale_lib</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">rho</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span>  <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_lib"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_lib_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_lib"</span><span class="op">]</span><span class="op">]</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    beta_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_Reff_m1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">l_effpop</span> <span class="op">-</span>
                      <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_lib2guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2g"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_lib2sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2s"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    effpop_lib <span class="op">=</span> <span class="va">popsize_lib</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_effpop</span><span class="op">)</span>,
    omega_lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_lib"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    mu_lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    rho_lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    phi_lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">logprior_lib</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">rho</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_lib"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_lib_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_lib"</span><span class="op">]</span><span class="op">]</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fl">1.08</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2g"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2g"</span><span class="op">]</span><span class="op">]</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2s"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_l2s"</span><span class="op">]</span><span class="op">]</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">l_effpop</span>, <span class="fl">9.9</span>, <span class="fl">0.62</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_lib"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_lib"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_lib"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0.85</span>, <span class="fl">0.75</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0.69</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_lib"</span><span class="op">]</span><span class="op">]</span>
      <span class="op">)</span>
<span class="op">}</span>

<span class="va">to_est_scale_sln</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_nat</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">l_effpop</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">popsize_sln</span> <span class="op">-</span> <span class="va">params_nat</span><span class="op">[[</span><span class="st">"effpop_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Neff_x_rho</span> <span class="op">&lt;-</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_infec_dur</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"mu_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">expm1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"beta_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> 
                              <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    log_Reff_sln_o <span class="op">=</span> <span class="va">l_Reff_m1</span> <span class="op">+</span> <span class="va">l_Neff_x_rho</span>,
    log_Rext_s2g <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_sln2guin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Rext_s2l <span class="op">=</span> <span class="va">l_effpop</span> <span class="op">+</span> <span class="va">l_infec_dur</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"alpha_sln2lib"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_Neff_x_rho_sln <span class="op">=</span> <span class="va">l_Neff_x_rho</span>,
    log_omega_d_mu_sln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"omega_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">l_infec_dur</span>,
    log_infec_dur_sln <span class="op">=</span> <span class="va">l_infec_dur</span>,
    logit_rho_sln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    log_sqrt_phi_inv_sln <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">params_nat</span><span class="op">[[</span><span class="st">"phi_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">from_est_scale_sln</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">rho</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span>  <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_sln"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  <span class="va">l_Reff_m1</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_sln_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_sln"</span><span class="op">]</span><span class="op">]</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    beta_sln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_Reff_m1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">l_effpop</span> <span class="op">-</span>
                      <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_sln2guin <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2g"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    alpha_sln2lib <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2l"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> 
            <span class="va">l_effpop</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    effpop_sln <span class="op">=</span> <span class="va">popsize_sln</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">l_effpop</span><span class="op">)</span>,
    omega_sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_sln"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    mu_sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    rho_sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    phi_sln <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">logprior_sln</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params_est</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">rho</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">l_effpop</span> <span class="op">&lt;-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_sln"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Reff_sln_o"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Neff_x_rho_sln"</span><span class="op">]</span><span class="op">]</span>, 
            <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fl">1.08</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2g"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2g"</span><span class="op">]</span><span class="op">]</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2l"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">40</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_Rext_s2l"</span><span class="op">]</span><span class="op">]</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">l_effpop</span>, <span class="fl">10.7</span>, <span class="fl">0.62</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_omega_d_mu_sln"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_infec_dur_sln"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0.3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"logit_rho_sln"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0.85</span>, <span class="fl">0.75</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
      <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_sln"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0.69</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
        <span class="va">params_est</span><span class="op">[[</span><span class="st">"log_sqrt_phi_inv_sln"</span><span class="op">]</span><span class="op">]</span>
      <span class="op">)</span>
<span class="op">}</span>

<span class="va">mcmc_kern</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/mcmc_kernel.html">mcmc_kernel</a></span><span class="op">(</span>
    parameter_blocks <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        <span class="fu"><a href="../reference/parblock.html">parblock</a></span><span class="op">(</span>pars_nat <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_guin"</span>, 
                     <span class="st">"alpha_guin2lib"</span>,
                     <span class="st">"alpha_guin2sln"</span>,
                     <span class="st">"effpop_guin"</span>,
                     <span class="st">"omega_guin"</span>,
                     <span class="st">"mu_guin"</span>,
                     <span class="st">"rho_guin"</span>,
                     <span class="st">"phi_guin"</span><span class="op">)</span>,
                 pars_est <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log_Reff_guin_o"</span>,
                     <span class="st">"log_Rext_g2l"</span>,
                     <span class="st">"log_Rext_g2s"</span>,
                     <span class="st">"log_Neff_x_rho_guin"</span>,
                     <span class="st">"log_omega_d_mu_guin"</span>,
                     <span class="st">"log_infec_dur_guin"</span>,
                     <span class="st">"logit_rho_guin"</span>,
                     <span class="st">"log_sqrt_phi_inv_guin"</span><span class="op">)</span>,
                 priors <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>logprior <span class="op">=</span> <span class="va">logprior_guin</span>,
                        to_estimation_scale <span class="op">=</span> <span class="va">to_est_scale_guin</span>,
                        from_estimation_scale <span class="op">=</span> <span class="va">from_est_scale_guin</span><span class="op">)</span>,
                 alg <span class="op">=</span> <span class="st">"mvnss"</span>,
                 sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,
                 initializer <span class="op">=</span> 
                   <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
                     <span class="fu">from_est_scale_guin</span><span class="op">(</span>
                       <span class="fu">to_est_scale_guin</span><span class="op">(</span>
                         <span class="va">parameters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_guin"</span>, 
                                      <span class="st">"alpha_guin2lib"</span>,
                                      <span class="st">"alpha_guin2sln"</span>,
                                      <span class="st">"effpop_guin"</span>,
                                      <span class="st">"omega_guin"</span>,
                                      <span class="st">"mu_guin"</span>,
                                      <span class="st">"rho_guin"</span>,
                                      <span class="st">"phi_guin"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
                   <span class="op">}</span>, 
                 control <span class="op">=</span> 
                   <span class="fu"><a href="../reference/mvnss_control.html">mvnss_control</a></span><span class="op">(</span>scale_constant <span class="op">=</span> <span class="fl">0.5</span>,
                                 scale_cooling <span class="op">=</span> <span class="fl">0.7</span>,
                                 stop_adaptation <span class="op">=</span> <span class="fl">5e4</span>,
                                 step_size <span class="op">=</span> <span class="fl">0.5</span>,
                                 nugget <span class="op">=</span> <span class="fl">1e-5</span>, 
                                 nugget_step_size <span class="op">=</span> <span class="fl">0.001</span>,
                                 nugget_cooling <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span>,
        <span class="fu"><a href="../reference/parblock.html">parblock</a></span><span class="op">(</span>pars_nat <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_lib"</span>, 
                     <span class="st">"alpha_lib2guin"</span>,
                     <span class="st">"alpha_lib2sln"</span>,
                     <span class="st">"effpop_lib"</span>,
                     <span class="st">"omega_lib"</span>,
                     <span class="st">"mu_lib"</span>,
                     <span class="st">"rho_lib"</span>,
                     <span class="st">"phi_lib"</span><span class="op">)</span>,
                 pars_est <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log_Reff_lib_o"</span>,
                     <span class="st">"log_Rext_l2g"</span>,
                     <span class="st">"log_Rext_l2s"</span>,
                     <span class="st">"log_Neff_x_rho_lib"</span>,
                     <span class="st">"log_omega_d_mu_lib"</span>,
                     <span class="st">"log_infec_dur_lib"</span>,
                     <span class="st">"logit_rho_lib"</span>,
                     <span class="st">"log_sqrt_phi_inv_lib"</span><span class="op">)</span>,
                 priors <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>logprior <span class="op">=</span> <span class="va">logprior_lib</span>,
                        to_estimation_scale <span class="op">=</span> <span class="va">to_est_scale_lib</span>,
                        from_estimation_scale <span class="op">=</span> <span class="va">from_est_scale_lib</span><span class="op">)</span>,
                 alg <span class="op">=</span> <span class="st">"mvnss"</span>,
                 sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,
                 initializer <span class="op">=</span> 
                   <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
                     <span class="fu">from_est_scale_lib</span><span class="op">(</span>
                       <span class="fu">to_est_scale_lib</span><span class="op">(</span>
                         <span class="va">parameters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_lib"</span>, 
                                      <span class="st">"alpha_lib2guin"</span>,
                                      <span class="st">"alpha_lib2sln"</span>,
                                      <span class="st">"effpop_lib"</span>,
                                      <span class="st">"omega_lib"</span>,
                                      <span class="st">"mu_lib"</span>,
                                      <span class="st">"rho_lib"</span>,
                                      <span class="st">"phi_lib"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
                   <span class="op">}</span>, 
                 control <span class="op">=</span> 
                   <span class="fu"><a href="../reference/mvnss_control.html">mvnss_control</a></span><span class="op">(</span>scale_constant <span class="op">=</span> <span class="fl">0.5</span>,
                                 scale_cooling <span class="op">=</span> <span class="fl">0.7</span>,
                                 stop_adaptation <span class="op">=</span> <span class="fl">5e4</span>,
                                 step_size <span class="op">=</span> <span class="fl">0.5</span>,
                                 nugget <span class="op">=</span> <span class="fl">1e-5</span>, 
                                 nugget_step_size <span class="op">=</span> <span class="fl">0.001</span>,
                                 nugget_cooling <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span>,
        <span class="fu"><a href="../reference/parblock.html">parblock</a></span><span class="op">(</span>pars_nat <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_sln"</span>, 
                     <span class="st">"alpha_sln2guin"</span>,
                     <span class="st">"alpha_sln2lib"</span>,
                     <span class="st">"effpop_sln"</span>,
                     <span class="st">"omega_sln"</span>,
                     <span class="st">"mu_sln"</span>,
                     <span class="st">"rho_sln"</span>,
                     <span class="st">"phi_sln"</span><span class="op">)</span>,
                 pars_est <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log_Reff_sln_o"</span>,
                     <span class="st">"log_Rext_s2g"</span>,
                     <span class="st">"log_Rext_s2l"</span>,
                     <span class="st">"log_Neff_x_rho_sln"</span>,
                     <span class="st">"log_omega_d_mu_sln"</span>,
                     <span class="st">"log_infec_dur_sln"</span>,
                     <span class="st">"logit_rho_sln"</span>,
                     <span class="st">"log_sqrt_phi_inv_sln"</span><span class="op">)</span>,
                 priors <span class="op">=</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>logprior <span class="op">=</span> <span class="va">logprior_sln</span>,
                        to_estimation_scale <span class="op">=</span> <span class="va">to_est_scale_sln</span>,
                        from_estimation_scale <span class="op">=</span> <span class="va">from_est_scale_sln</span><span class="op">)</span>,
                 alg <span class="op">=</span> <span class="st">"mvnss"</span>,
                 sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,
                 initializer <span class="op">=</span> 
                   <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
                     <span class="fu">from_est_scale_sln</span><span class="op">(</span>
                       <span class="fu">to_est_scale_sln</span><span class="op">(</span>
                         <span class="va">parameters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta_sln"</span>, 
                                      <span class="st">"alpha_sln2guin"</span>,
                                      <span class="st">"alpha_sln2lib"</span>,
                                      <span class="st">"effpop_sln"</span>,
                                      <span class="st">"omega_sln"</span>,
                                      <span class="st">"mu_sln"</span>,
                                      <span class="st">"rho_sln"</span>,
                                      <span class="st">"phi_sln"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
                   <span class="op">}</span>, 
                 control <span class="op">=</span> 
                   <span class="fu"><a href="../reference/mvnss_control.html">mvnss_control</a></span><span class="op">(</span>scale_constant <span class="op">=</span> <span class="fl">0.5</span>,
                                 scale_cooling <span class="op">=</span> <span class="fl">0.7</span>,
                                 stop_adaptation <span class="op">=</span> <span class="fl">5e4</span>,
                                 step_size <span class="op">=</span> <span class="fl">0.5</span>,
                                 nugget <span class="op">=</span> <span class="fl">1e-5</span>, 
                                 nugget_step_size <span class="op">=</span> <span class="fl">0.001</span>,
                                 nugget_cooling <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    lna_ess_control <span class="op">=</span> <span class="fu"><a href="../reference/lna_control.html">lna_control</a></span><span class="op">(</span>bracket_update_iter <span class="op">=</span> <span class="fl">5e3</span>,
                                  joint_initdist_update <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>


<span class="co"># fit the model</span>
<span class="va">res</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/fit_stem.html">fit_stem</a></span><span class="op">(</span>stem_object <span class="op">=</span> <span class="va">stem_object</span>,
                 method <span class="op">=</span> <span class="st">"ode"</span>,
                 iterations <span class="op">=</span> <span class="fl">1.5e5</span>, 
                 thinning_interval <span class="op">=</span> <span class="fl">100</span>,
                 mcmc_kern <span class="op">=</span> <span class="va">mcmc_kern</span><span class="op">)</span></code></pre></div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Fintzi, J., Wakefield, J., &amp; Minin, V. N. (2020). <strong>A linear noise approximation for stochastic epidemic models fit to partially observed incidence counts.</strong> arXiv preprint arXiv:2001.05099.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jon Fintzi, Jon Wakefield, Vladimir Minin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
